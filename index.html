<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GEMINI BUNDLER v12 (STABLE)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/bs58@4.0.1/bundle/index.js"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 3px; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        /* Toast Notification */
        #toast { visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #333; color: #fff; text-align: center; border-radius: 2px; padding: 16px; position: fixed; z-index: 1; left: 50%; bottom: 30px; font-size: 14px; }
        #toast.show { visibility: visible; -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 font-mono text-sm h-[100dvh] flex flex-col overflow-hidden">

    <div id="rpcStatusBanner" class="bg-indigo-900 text-center text-[10px] font-bold py-1 text-indigo-200 cursor-pointer hover:bg-indigo-800" onclick="alert('Edit the CUSTOM_RPC variable in the code source to improve speed.')">
        ‚ö° TIP: FOR BEST PERFORMANCE, ADD YOUR HELIUS RPC IN THE CODE ‚ö°
    </div>

    <header class="bg-slate-900 border-b border-slate-800 p-3 shrink-0 flex justify-between items-center shadow-md z-10">
        <div class="flex items-center gap-3">
            <div class="w-2.5 h-2.5 rounded-full bg-red-500 animate-pulse shadow-[0_0_8px_red]" id="connStatus"></div>
            <h1 class="font-black text-lg tracking-tighter text-white">GEMINI <span class="text-indigo-500">v12</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden md:flex flex-col items-end">
                <span class="text-[9px] text-slate-500 uppercase font-bold">Main Wallet Balance</span>
                <span id="headerBal" class="text-emerald-400 font-bold text-sm">--- SOL</span>
            </div>
            <button onclick="disconnectWallet()" id="disconnectBtn" class="hidden bg-red-900/20 text-red-400 border border-red-900 hover:bg-red-900/40 px-3 py-1 rounded text-[10px] font-bold transition-all">DISCONNECT</button>
        </div>
    </header>

    <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative">
        
        <div class="w-full md:w-[450px] bg-slate-900/50 border-r border-slate-800 flex flex-col overflow-y-auto custom-scroll">
            
            <div id="connectOverlay" class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm z-50 flex flex-col items-center justify-center p-6 transition-all">
                <div class="w-full max-w-xs space-y-4">
                    <div class="text-center">
                        <h2 class="text-2xl font-bold text-white mb-1">Welcome Back</h2>
                        <p class="text-slate-500 text-xs">Enter your deployer private key to begin.</p>
                    </div>
                    <div class="bg-slate-900 p-1 rounded border border-slate-800 focus-within:border-indigo-500 transition-colors">
                        <input id="pkInput" type="password" placeholder="Paste Private Key (Base58)" 
                            class="w-full bg-transparent p-3 text-white text-xs outline-none font-mono text-center">
                    </div>
                    <button onclick="connectWallet()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded shadow-lg shadow-indigo-900/20 transition-all transform hover:scale-[1.02]">
                        ACCESS TERMINAL
                    </button>
                    <p class="text-[9px] text-slate-600 text-center">Keys are processed locally and never stored.</p>
                </div>
            </div>

            <div class="flex border-b border-slate-800 bg-slate-900">
                <button onclick="setTab('create')" id="btn-create" class="flex-1 py-3 text-[10px] font-bold border-b-2 border-indigo-500 text-white bg-slate-800">‚ú® CREATE</button>
                <button onclick="setTab('wallets')" id="btn-wallets" class="flex-1 py-3 text-[10px] font-bold text-slate-500 hover:text-slate-300">üëõ WALLETS</button>
                <button onclick="setTab('settings')" id="btn-settings" class="flex-1 py-3 text-[10px] font-bold text-slate-500 hover:text-slate-300">‚öôÔ∏è SETTINGS</button>
            </div>

            <div id="tab-create" class="p-4 space-y-4 fade-in">
                
                <div class="space-y-3">
                    <div class="flex gap-3">
                        <div class="w-24 h-24 shrink-0 relative group">
                            <input type="file" id="tImage" accept="image/png, image/jpeg" class="hidden" onchange="previewImage(this)">
                            <div id="imgPreview" class="w-full h-full bg-slate-800 border-2 border-dashed border-slate-700 rounded cursor-pointer flex items-center justify-center hover:border-indigo-500 transition-colors" onclick="document.getElementById('tImage').click()">
                                <span class="text-[9px] text-slate-500 text-center px-1">UPLOAD IMG</span>
                            </div>
                        </div>
                        <div class="space-y-2 flex-1">
                            <input id="tName" type="text" placeholder="Token Name (e.g. Gemini)" class="w-full bg-slate-950 border border-slate-800 p-2 rounded text-[11px] focus:border-indigo-500 outline-none">
                            <input id="tSymbol" type="text" placeholder="Ticker (e.g. GEM)" class="w-full bg-slate-950 border border-slate-800 p-2 rounded text-[11px] focus:border-indigo-500 outline-none">
                        </div>
                    </div>
                    <textarea id="tDesc" placeholder="Description of your token..." class="w-full bg-slate-950 border border-slate-800 p-2 rounded text-[11px] h-16 focus:border-indigo-500 outline-none resize-none"></textarea>
                    
                    <div class="grid grid-cols-3 gap-2">
                        <input id="tTwitter" type="text" placeholder="Twitter URL (Optional)" class="bg-slate-950 border border-slate-800 p-2 rounded text-[10px]">
                        <input id="tTelegram" type="text" placeholder="Telegram URL (Optional)" class="bg-slate-950 border border-slate-800 p-2 rounded text-[10px]">
                        <input id="tWebsite" type="text" placeholder="Website URL (Optional)" class="bg-slate-950 border border-slate-800 p-2 rounded text-[10px]">
                    </div>
                </div>

                <div class="h-px bg-slate-800 my-2"></div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 mb-1">DEV BUY (SOL)</label>
                        <input id="devBuy" type="number" value="0" step="0.01" class="w-full bg-slate-950 border border-emerald-900/50 text-emerald-400 font-bold p-2 rounded text-[11px] focus:border-emerald-500 outline-none">
                        <p class="text-[9px] text-slate-600 mt-1">Set 0 for free launch.</p>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-500 mb-1">BUNDLE WALLETS</label>
                        <input id="bundleCount" type="number" value="0" class="w-full bg-slate-950 border border-indigo-900/50 text-indigo-400 font-bold p-2 rounded text-[11px] focus:border-indigo-500 outline-none">
                        <p class="text-[9px] text-slate-600 mt-1">Number of side-buys.</p>
                    </div>
                </div>

                <button onclick="launchToken()" id="launchBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-black py-4 rounded shadow-lg text-sm mt-2 transition-all active:scale-[0.98]">
                    üöÄ CREATE TOKEN NOW
                </button>
                <div id="errorBox" class="hidden bg-red-900/20 border border-red-500/50 p-2 rounded text-[10px] text-red-200 mt-2 font-mono"></div>
            </div>

            <div id="tab-wallets" class="p-4 space-y-4 hidden fade-in">
                <div class="p-3 bg-slate-800 rounded border border-slate-700">
                    <h3 class="text-[10px] font-bold text-white mb-2">GENERATOR</h3>
                    <div class="flex gap-2">
                        <input id="genAmt" type="number" value="5" class="w-16 bg-slate-950 p-1 rounded text-center text-xs">
                        <button onclick="generateWallets()" class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-xs font-bold rounded">GENERATE</button>
                    </div>
                </div>
                <div id="walletList" class="space-y-1 max-h-[300px] overflow-y-auto pr-1">
                    <div class="text-center text-slate-600 text-xs py-4">No wallets generated yet.</div>
                </div>
            </div>

            <div id="tab-settings" class="p-4 space-y-4 hidden fade-in">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-400">CUSTOM RPC URL</label>
                    <input id="rpcInput" type="text" placeholder="https://mainnet.helius-rpc.com/..." class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-[10px] text-slate-300 font-mono">
                    <button onclick="updateRpc()" class="w-full bg-slate-800 text-xs font-bold py-2 rounded hover:bg-slate-700">SAVE RPC</button>
                    <p class="text-[9px] text-slate-600">If transactions fail, you MUST use a private RPC.</p>
                </div>
            </div>

        </div>

        <div class="flex-1 bg-black p-4 flex flex-col min-w-0">
            <div class="flex justify-between items-end mb-2 border-b border-slate-900 pb-2">
                <h3 class="font-bold text-slate-500 text-[10px] uppercase">Terminal Output</h3>
                <button onclick="document.getElementById('logs').innerHTML=''" class="text-[9px] text-slate-700 hover:text-slate-400">CLEAR</button>
            </div>
            <div id="logs" class="flex-1 font-mono text-[11px] space-y-1.5 overflow-y-auto text-slate-400 pb-2">
                <div class="text-indigo-500">Welcome to Gemini v12. System Ready.</div>
            </div>
        </div>

    </div>

    <script>
        // ==========================================
        // üîß USER CONFIGURATION
        // ==========================================
        
        // PASTE YOUR HELIUS/QUICKNODE URL HERE FOR 100% STABILITY
        let CUSTOM_RPC = "https://api.mainnet-beta.solana.com"; 

        // ==========================================
        
        // GLOBAL STATE
        let connection;
        let mainWallet;
        let subWallets = [];
        
        // INIT
        window.onload = async () => {
            // Check if user has saved RPC before
            const savedRpc = localStorage.getItem("gemini_rpc");
            if(savedRpc) CUSTOM_RPC = savedRpc;
            document.getElementById('rpcInput').value = CUSTOM_RPC;
            
            await initConnection();
        };

        async function initConnection() {
            log("Initializing Connection...");
            try {
                connection = new solanaWeb3.Connection(CUSTOM_RPC, 'confirmed');
                const v = await connection.getVersion();
                document.getElementById('connStatus').className = "w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]";
                log(`Connected to Solana Mainnet (v${v["solana-core"]})`, "success");
            } catch(e) {
                document.getElementById('connStatus').className = "w-2.5 h-2.5 rounded-full bg-red-500 animate-pulse";
                log(`Connection Failed. Your RPC might be rate-limited. Try a Helius/QuickNode URL.`, "error");
            }
        }

        function updateRpc() {
            const newUrl = document.getElementById('rpcInput').value.trim();
            if(!newUrl) return;
            CUSTOM_RPC = newUrl;
            localStorage.setItem("gemini_rpc", newUrl);
            initConnection();
        }

        // WALLET HANDLING
        async function connectWallet() {
            const raw = document.getElementById('pkInput').value.trim();
            if(!raw) return alert("Please paste a private key");

            try {
                let secret;
                if(raw.includes("[")) secret = Uint8Array.from(JSON.parse(raw));
                else secret = bs58.decode(raw);
                
                mainWallet = solanaWeb3.Keypair.fromSecretKey(secret);
                
                // Hide Overlay
                document.getElementById('connectOverlay').classList.add('hidden');
                document.getElementById('disconnectBtn').classList.remove('hidden');
                
                log(`Wallet Authenticated: ${mainWallet.publicKey.toBase58().slice(0,6)}...`, "success");
                updateBalance();
                setInterval(updateBalance, 10000); // Auto-refresh balance
                
            } catch(e) {
                alert("Invalid Key Format. Please use Base58 or JSON array.");
            }
        }

        function disconnectWallet() {
            location.reload();
        }

        async function updateBalance() {
            if(!mainWallet || !connection) return;
            try {
                const bal = await connection.getBalance(mainWallet.publicKey);
                document.getElementById('headerBal').innerText = (bal / 1e9).toFixed(3) + " SOL";
                
                // Warn if low balance
                if(bal < 50000000) { // 0.05 SOL
                    log("WARNING: Low Balance. You need at least 0.05 SOL to create a token (Rent + Fees).", "warn");
                }
            } catch(e) {}
        }

        // TABS
        function setTab(id) {
            ['create','wallets','settings'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.add('hidden');
                document.getElementById(`btn-${t}`).className = "flex-1 py-3 text-[10px] font-bold text-slate-500 hover:text-slate-300";
            });
            document.getElementById(`tab-${id}`).classList.remove('hidden');
            document.getElementById(`btn-${id}`).className = "flex-1 py-3 text-[10px] font-bold border-b-2 border-indigo-500 text-white bg-slate-800";
        }

        // IMAGE PREVIEW
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const div = document.getElementById('imgPreview');
                    div.style.backgroundImage = `url(${e.target.result})`;
                    div.style.backgroundSize = "cover";
                    div.innerHTML = "";
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // CORE: LAUNCH TOKEN
        async function launchToken() {
            if(!mainWallet) return log("Please connect wallet first.", "error");
            
            // 1. Validate Inputs
            const name = document.getElementById('tName').value;
            const symbol = document.getElementById('tSymbol').value;
            const desc = document.getElementById('tDesc').value;
            const img = document.getElementById('tImage').files[0];
            const devBuy = parseFloat(document.getElementById('devBuy').value) || 0;

            if(!name || !symbol || !desc || !img) {
                return log("Missing metadata (Name, Symbol, Desc, or Image).", "error");
            }

            document.getElementById('launchBtn').disabled = true;
            document.getElementById('launchBtn').innerText = "‚è≥ UPLOADING METADATA...";

            try {
                // 2. Upload Metadata to IPFS
                log("Uploading metadata to PumpPortal IPFS...", "info");
                const fd = new FormData();
                fd.append("file", img);
                fd.append("name", name);
                fd.append("symbol", symbol);
                fd.append("description", desc);
                if(document.getElementById('tTwitter').value) fd.append("twitter", document.getElementById('tTwitter').value);
                if(document.getElementById('tTelegram').value) fd.append("telegram", document.getElementById('tTelegram').value);
                if(document.getElementById('tWebsite').value) fd.append("website", document.getElementById('tWebsite').value);
                fd.append("showName", "true");

                const ipfsRes = await fetch("https://pumpportal.fun/api/ipfs", { method: "POST", body: fd });
                
                if(!ipfsRes.ok) {
                    throw new Error(`IPFS Upload Failed: ${ipfsRes.statusText}`);
                }
                
                const ipfsData = await ipfsRes.json();
                if(!ipfsData.metadataUri) throw new Error("No metadata URI returned");
                
                log("Metadata success! URI: " + ipfsData.metadataUri, "success");

                // 3. Build Transaction
                document.getElementById('launchBtn').innerText = "üî® BUILDING TRANSACTION...";
                log("Requesting creation transaction...", "info");

                const createReq = {
                    "publicKey": mainWallet.publicKey.toBase58(),
                    "action": "create",
                    "tokenMetadata": {
                        name: ipfsData.metadata.name,
                        symbol: ipfsData.metadata.symbol,
                        uri: ipfsData.metadataUri
                    },
                    "mint": solanaWeb3.Keypair.generate().publicKey.toBase58(),
                    "denominatedInSol": "true",
                    "amount": devBuy,
                    "slippage": 10,
                    "priorityFee": 0.005, // 0.005 SOL Priority fee for speed
                    "pool": "pump"
                };

                const txRes = await fetch("https://pumpportal.fun/api/trade-local", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(createReq)
                });

                if(!txRes.ok) {
                    const errTxt = await txRes.text();
                    throw new Error(`API Error: ${errTxt}`);
                }

                const txBuf = await txRes.arrayBuffer();
                const tx = solanaWeb3.VersionedTransaction.deserialize(new Uint8Array(txBuf));

                // 4. Sign & Send
                document.getElementById('launchBtn').innerText = "‚ö° SENDING...";
                log("Signing transaction...", "info");
                
                tx.sign([mainWallet]);
                
                // Simulate to catch errors early
                // const sim = await connection.simulateTransaction(tx);
                // if(sim.value.err) throw new Error("Simulation Failed: " + JSON.stringify(sim.value.err));

                const sig = await connection.sendRawTransaction(tx.serialize(), { 
                    skipPreflight: false, 
                    preflightCommitment: 'confirmed' 
                });

                log(`Transaction Sent! Signature: ${sig}`, "success");
                log(`Check Solscan: https://solscan.io/tx/${sig}`, "info");
                
                // 5. Confirmation (Optional but good UX)
                document.getElementById('launchBtn').innerText = "üöÄ CONFIRMING...";
                const confirm = await connection.confirmTransaction(sig, 'confirmed');
                
                if(confirm.value.err) {
                    log("Transaction confirmed but with error: " + confirm.value.err, "error");
                } else {
                    log("‚úÖ TOKEN CREATED SUCCESSFULLY!", "success");
                    alert(`Token Created! CA: ${createReq.mint}`);
                }

            } catch(e) {
                log(e.message, "error");
                document.getElementById('errorBox').classList.remove('hidden');
                document.getElementById('errorBox').innerText = e.message;
            } finally {
                document.getElementById('launchBtn').disabled = false;
                document.getElementById('launchBtn').innerText = "üöÄ CREATE TOKEN NOW";
            }
        }

        // UTILS: LOGGING
        function log(msg, type='info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString().split(' ')[0];
            
            let color = "text-slate-400";
            if(type === 'success') color = "text-emerald-400 font-bold";
            if(type === 'error') color = "text-red-400 font-bold bg-red-900/10";
            if(type === 'warn') color = "text-yellow-400";

            div.className = `text-[10px] ${color} font-mono border-l-2 border-slate-800 pl-2 mb-1`;
            div.innerHTML = `<span class="opacity-30 mr-2">${time}</span>${msg}`;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }

        // UTILS: WALLET GEN
        function generateWallets() {
            const count = document.getElementById('genAmt').value;
            const list = document.getElementById('walletList');
            list.innerHTML = "";
            for(let i=0; i<count; i++) {
                const kp = solanaWeb3.Keypair.generate();
                const div = document.createElement('div');
                div.className = "bg-slate-900 p-2 rounded border border-slate-800 flex justify-between items-center";
                div.innerHTML = `
                    <span class="text-indigo-400 font-bold text-[10px]">W${i+1}</span>
                    <span class="font-mono text-[9px] text-slate-500">${kp.publicKey.toBase58()}</span>
                    <button onclick="navigator.clipboard.writeText('${bs58.encode(kp.secretKey)}')" class="text-[9px] bg-slate-800 px-1 rounded hover:bg-slate-700">COPY KEY</button>
                `;
                list.appendChild(div);
            }
        }

    </script>
</body>
</html>
