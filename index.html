<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PRO Volume Engine - Real Money</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body class="bg-slate-950 text-slate-200 p-4 font-mono">
    <div class="max-w-4xl mx-auto space-y-4">
        
        <div class="bg-gradient-to-r from-red-600 to-orange-600 p-4 rounded-xl flex justify-between items-center shadow-2xl">
            <div>
                <h1 class="text-xl font-black text-white italic underline uppercase">Live Real-Money Engine</h1>
                <p class="text-[10px] text-red-100 font-bold tracking-widest uppercase">Multi-Wallet Local Signing v4.0</p>
            </div>
            <div id="connectionStatus" class="bg-black/40 px-3 py-1 rounded-full text-[10px] font-black text-red-400 border border-red-500/50">
                CONNECTING...
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-slate-900 border border-slate-800 p-5 rounded-2xl space-y-5 shadow-xl">
                <div>
                    <label class="text-[10px] text-slate-500 font-black uppercase">Token Address (CA)</label>
                    <input id="mint" type="text" placeholder="Pump.fun CA" class="w-full bg-black p-3 rounded-lg border border-slate-700 text-xs text-blue-400 mt-1 outline-none focus:border-blue-500">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] text-slate-500 font-black uppercase italic">Wallet Count</label>
                        <input id="numWallets" type="number" value="3" class="w-full bg-black p-3 rounded-lg border border-slate-700 text-xs mt-1">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 font-black uppercase italic">Fund (SOL)</label>
                        <input id="fundAmount" type="number" value="0.05" step="0.01" class="w-full bg-black p-3 rounded-lg border border-slate-700 text-xs mt-1">
                    </div>
                </div>

                <div class="space-y-2 pt-2">
                    <button onclick="distributeSOL()" id="fundBtn" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-black py-3 rounded-xl text-[10px] uppercase tracking-tighter transition-all shadow-lg active:scale-95">
                        Step 1: Distribute SOL to Subs
                    </button>
                    <button onclick="startEngine()" id="startBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-4 rounded-xl text-sm uppercase tracking-widest transition-all shadow-xl active:scale-95">
                        Step 2: Start Volume
                    </button>
                </div>
            </div>

            <div class="md:col-span-2 bg-black rounded-2xl border border-slate-800 flex flex-col h-[500px] overflow-hidden">
                <div class="p-3 border-b border-slate-800 flex justify-between bg-slate-900/40">
                    <span class="text-[10px] font-bold text-slate-500">ENGINE HEARTBEAT</span>
                    <span id="balanceDisplay" class="text-[10px] text-yellow-500 font-black">SYNCING WALLET...</span>
                </div>
                <div id="logBox" class="p-4 overflow-y-auto text-[11px] flex-grow space-y-1 scrollbar-hide">
                    <div class="text-blue-500 italic opacity-50">Initializing Secure local signing environment...</div>
                </div>
                <div class="p-4 border-t border-slate-800 bg-slate-900/10 grid grid-cols-2 gap-4">
                    <button onclick="downloadBackup()" class="bg-slate-800 hover:bg-slate-700 text-white text-[10px] font-bold py-2 rounded-lg uppercase">Backup Keys</button>
                    <button onclick="stopEngine()" class="bg-red-900/20 border border-red-600/50 text-red-500 text-[10px] font-bold py-2 rounded-lg uppercase">Emergency Stop</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        const PRIV_KEY_B58 = "3ELdVUniK8FkwuyHcBaz7pVVb5m84RkS6F878r493aYMPJDdo15gqgfmPcejpT33hwMj1JKv1uCdygZxtLfcFPVi";
        const RPC_ENDPOINT = "https://mainnet.helius-rpc.com/?api-key=8fb904ee-3236-4d78-ba87-91da6ea352d6";
        const PUBLIC_KEY_MAIN = "J3XKWusVusKttbMiKHJQzdyhrxgw64L9RA5WrKm88BxL";

        // --- INTERNAL BASE58 DECODER ---
        const A = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
        function b58Decode(s) {
            let b = [0];
            for (let i=0; i<s.length; i++) {
                let c = A.indexOf(s[i]);
                if (c < 0) throw "Error";
                for (let j=0; j<b.length; j++) b[j] *= 58;
                b[0] += c;
                let carry = 0;
                for (let j=0; j<b.length; j++) {
                    b[j] += carry;
                    carry = b[j] >> 8;
                    b[j] &= 0xff;
                }
                while (carry) { b.push(carry & 0xff); carry >>= 8; }
            }
            for (let i=0; i<s.length && s[i]==='1'; i++) b.push(0);
            return new Uint8Array(b.reverse());
        }

        // --- GLOBALS ---
        const connection = new solanaWeb3.Connection(RPC_ENDPOINT, 'confirmed');
        let mainWallet, subWallets = [], isRunning = false;

        function addLog(m, type="info") {
            const l = document.getElementById('logBox');
            const d = document.createElement('div');
            const color = { info: 'text-slate-400', success: 'text-green-400 font-bold', warn: 'text-yellow-500', error: 'text-red-500' }[type];
            d.className = color;
            d.innerHTML = `[${new Date().toLocaleTimeString()}] ${m}`;
            l.prepend(d);
        }

        async function init() {
            try {
                mainWallet = solanaWeb3.Keypair.fromSecretKey(b58Decode(PRIV_KEY_B58));
                const b = await connection.getBalance(mainWallet.publicKey);
                document.getElementById('balanceDisplay').innerText = `MAIN: ${(b/1e9).toFixed(3)} SOL`;
                document.getElementById('connectionStatus').innerText = "SYSTEM ONLINE";
                document.getElementById('connectionStatus').className = "bg-green-900/40 px-3 py-1 rounded-full text-[10px] font-black text-green-400 border border-green-500/50";
                addLog("Main Wallet linked successfully.", "success");
            } catch(e) { addLog("Initialization Failed: Check Private Key", "error"); }
        }
        window.onload = init;

        // --- STEP 1: DISTRIBUTE ---
        async function distributeSOL() {
            const count = parseInt(document.getElementById('numWallets').value);
            const amount = parseFloat(document.getElementById('fundAmount').value);
            const btn = document.getElementById('fundBtn');

            btn.disabled = true;
            btn.innerText = "PREPARING TRANSACTIONS...";
            addLog(`Generating ${count} new sub-wallets...`, "warn");

            subWallets = [];
            for(let i=0; i<count; i++) subWallets.push(solanaWeb3.Keypair.generate());

            const tx = new solanaWeb3.Transaction();
            subWallets.forEach(sw => {
                tx.add(solanaWeb3.SystemProgram.transfer({
                    fromPubkey: mainWallet.publicKey,
                    toPubkey: sw.publicKey,
                    lamports: Math.floor(amount * solanaWeb3.LAMPORTS_PER_SOL)
                }));
            });

            try {
                addLog(`Funding sub-wallets... Please wait for confirmation.`, "info");
                const sig = await solanaWeb3.sendAndConfirmTransaction(connection, tx, [mainWallet]);
                addLog(`FUNDING CONFIRMED: ${sig.slice(0,10)}...`, "success");
                downloadBackup();
                btn.innerText = "FUNDED & READY";
                btn.className = "w-full bg-green-700 text-white font-black py-3 rounded-xl text-[10px] uppercase shadow-lg";
            } catch(e) { 
                addLog("Funding Failed: Check Main SOL balance.", "error"); 
                btn.disabled = false;
                btn.innerText = "RETRY FUNDING";
            }
        }

        // --- STEP 2: TRADE LOOP ---
        async function startEngine() {
            const mint = document.getElementById('mint').value;
            if(!mint || subWallets.length === 0) return alert("Enter CA and Fund Wallets first!");

            isRunning = true;
            document.getElementById('startBtn').innerText = "ENGINE ACTIVE";
            document.getElementById('startBtn').classList.replace('bg-blue-600', 'bg-red-600');
            addLog("--- VOLUME LOOP STARTING ---", "success");

            while(isRunning) {
                const activeWallet = subWallets[Math.floor(Math.random() * subWallets.length)];
                const buyAmount = (Math.random() * (0.04 - 0.01) + 0.01).toFixed(3);

                try {
                    const res = await fetch('https://pumpportal.fun/api/trade-local', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            "publicKey": activeWallet.publicKey.toBase58(),
                            "action": "buy",
                            "mint": mint,
                            "amount": buyAmount,
                            "denominatedInSol": "true",
                            "slippage": 15,
                            "priorityFee": 0.003,
                            "pool": "pump"
                        })
                    });

                    if(res.ok) {
                        const data = await res.arrayBuffer();
                        const tx = solanaWeb3.VersionedTransaction.deserialize(new Uint8Array(data));
                        tx.sign([activeWallet]);
                        const sig = await connection.sendRawTransaction(tx.serialize());
                        addLog(`TX: ${activeWallet.publicKey.toBase58().slice(0,4)} bought ${buyAmount} SOL`, "success");
                    } else { addLog("Trade Rejected (Check sub-wallet SOL balance)", "error"); }
                } catch(e) { console.error(e); }

                await new Promise(r => setTimeout(r, 12000));
            }
        }

        function stopEngine() { isRunning = false; location.reload(); }

        function downloadBackup() {
            if(subWallets.length === 0) return;
            const data = subWallets.map(w => ({ pub: w.publicKey.toBase58(), secret: Array.from(w.secretKey) }));
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `wallet_backup_${Date.now()}.json`;
            a.click();
        }
    </script>
</body>
</html>
